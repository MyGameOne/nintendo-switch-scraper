# Nintendo Switch 爬虫数据优化需求文档

## 项目概述

优化Nintendo Switch游戏爬虫的数据提取逻辑，修复NS2游戏数据获取问题，提升数据质量，同时保持系统的简洁性。

## 需求分析

### 1. 核心问题
- NS2游戏的rom_size获取不准确（取到空值）
- 缺少用户友好的平台名称显示
- screenshots数据可能包含无效URL

### 2. 业务目标
- 确保所有游戏（NS1/NS2）的容量信息准确
- 提供更好的用户体验（平台名称显示）
- 保持数据库结构的简洁性
- 最小化破坏性更新的影响

## 功能需求

### 需求1: 智能容量获取

**用户故事**: 作为管理员，我希望看到所有游戏的准确容量信息，无论是NS1还是NS2游戏。

#### 验收标准
1. WHEN 爬取NS1游戏 THEN 系统应获取HAC平台的容量信息
2. WHEN 爬取NS2游戏 THEN 系统应优先获取BEE平台的容量信息
3. WHEN 某平台容量信息缺失 THEN 系统应回退到其他可用平台
4. WHEN 所有平台都无容量信息 THEN 系统应存储null值

### 需求2: 平台名称显示

**用户故事**: 作为用户，我希望在界面上看到友好的平台名称（如"Nintendo Switch 2"），而不是技术代号（如"BEE"）。

#### 验收标准
1. WHEN 显示游戏信息 THEN 系统应显示平台的友好名称
2. WHEN 平台名称不可用 THEN 系统应回退到技术代号
3. WHEN 存储游戏数据 THEN 系统应同时保存技术代号和友好名称

### 需求3: 数据质量提升

**用户故事**: 作为系统，我需要确保存储的数据是干净和有效的。

#### 验收标准
1. WHEN 处理截图数据 THEN 系统应过滤掉无效的URL
2. WHEN 处理截图数据 THEN 系统应确保返回字符串数组
3. WHEN 数据提取失败 THEN 系统应记录警告但不中断流程

## 技术需求

### 需求4: 数据库兼容性

**用户故事**: 作为开发者，我需要确保数据库更新不会破坏现有功能。

#### 验收标准
1. WHEN 添加新字段 THEN 现有数据应保持完整
2. WHEN 修改提取逻辑 THEN 新旧数据应能共存
3. WHEN 部署更新 THEN 系统应支持渐进式迁移

### 需求5: 向后兼容

**用户故事**: 作为系统管理员，我需要确保前端和API在数据结构更新期间正常工作。

#### 验收标准
1. WHEN API返回数据 THEN 应包含新旧字段以保证兼容性
2. WHEN 前端请求数据 THEN 应能处理字段缺失的情况
3. WHEN 数据迁移进行中 THEN 系统应保持可用性

## 非功能需求

### 性能需求
- 数据提取性能不应显著下降
- 数据库查询性能应保持稳定

### 可维护性需求
- 代码修改应最小化
- 新增逻辑应易于理解和维护

### 可靠性需求
- 数据提取失败不应影响其他字段
- 系统应能处理意外的数据结构

## 约束条件

### 技术约束
- 不添加复杂的新字段（如完整评级信息、DLC列表等）
- 保持现有API接口的基本结构
- 数据库迁移应支持零停机时间

### 业务约束
- 优化应在一个开发周期内完成
- 不影响现有用户的使用体验
- 保持数据的一致性和准确性

## 成功标准

1. **数据准确性**: 95%以上的游戏容量信息准确
2. **用户体验**: 平台名称显示友好且准确
3. **系统稳定性**: 无破坏性更新导致的系统故障
4. **迁移成功率**: 100%的现有数据成功迁移

## 风险评估

### 高风险
- 数据库结构变更可能影响现有功能
- 大量数据需要重新爬取

### 中风险
- 前端界面需要适配新字段
- API响应结构变化

### 低风险
- 爬虫逻辑优化
- 数据清理逻辑